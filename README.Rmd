---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# threads

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

The goal of threads is to interact with the Slack API to retrieve and interrogate team conversations.

## Installation

``` r
remotes::install_github("yonicd/threads")
```

## In the Tin

  - httr call for Slack API [conversation.history](https://api.slack.com/methods/conversations.history)
  - httr call for Slack API [conversation.replies](https://api.slack.com/methods/conversations.replies)
  - Pagination Functions

## Example Using [R4DS Slack](https://www.rfordatasci.com/)

```{r}
library(slackteams)
library(threads)

```
 
### Load the Team 
```{r}
slackteams::load_teams()
slackteams::activate_team('r4ds')

```
 
### Retrieve Team Channels 
 
```{r}
chnls <- slackteams::get_team_channels()

 # r4ds has channels to ask questions in
question_channels <- sort(
  grep('^[1-9]', chnls$name[chnls$is_channel], value = TRUE)
)

question_channels
```
 
### Retrieve Conversations 

This will retrieve the last 20 messages from each channel

```{r}

# question_channels <- setNames(question_channels, question_channels)

convos <- purrr::map_dfr(
  question_channels, ~threads::get_conversations(channel = .x, limit = 20)
) 
  
convos
```
 
### Pagination 
 
We are in the process of merging pagination into the `get_*` functions. 

### Messages Replies (Threads)

How many replies were there to the first message?

```{r}
convos$reply_count[[1]]
```

Retrieve that reply.

The first element will be the parent message and the subsequent ones are the messages in the thread.

```{r}
reply <- threads::get_replies(convos$ts[[1]], channel = convos$channel[[1]])
```
 
Check that request was returned ok and how many messages where returned
 
```{r}
reply$ok
length(reply$messages)
```

## Contributing

Please note that the 'threads' project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
